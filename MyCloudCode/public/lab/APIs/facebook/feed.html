<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Get home feed</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="John Tubert">
	<!-- Date: 2011-02-28 -->
	
	<script src="js/jquery-1.4.4-min.js"></script>
	<script src="http://connect.facebook.net/en_US/all.js"></script>
	<style>
		img{
			width:200px;
		}

		p{
			width:500px;
		}
	</style>
</head>
<body>
	
	<div id="fb-root"></div>
<script>

	Array.prototype.pushUnique = function (item){
	    if(this.indexOf(item) == -1) {    
	        this.push(item);
	        return true;
	    }
	    return false;
	}

	window.fbAsyncInit = function() {
     	FB.init({appId: "313518962064403", status: true, cookie: true, xfbml: true});

     	function updateButton(response) {
	        button       =   document.getElementById('fb-auth');	        
	        
	        if (response.authResponse) {
	            //user is already logged in and connected
	            FB.api('/me', function(info) {
	                getHomeFeed();
	            });
	            
	            button.onclick = function() {
	                FB.logout(function(response) {
	                    //logout(response);
	                });
	            };
	        } else {
	            //user is not connected to your app or logged out
	            button.innerHTML = 'Login';
	            button.onclick = function() {
	                
					//console.log("login");
					
	                FB.login(function(response) {
	                    if (response.authResponse) {
	                        FB.api('/me', function(info) {
	                            getHomeFeed();
	                        });	   
	                    } else {
	                        //user cancelled login or did not grant authorization
	                        
	                    }
	                }, {scope:'read_stream,friends_actions.music,user_actions.music'});  	
	            }
	        }
	    }
	    
	    // run once with current status and whenever the status changes
	    FB.getLoginStatus(updateButton);
	    FB.Event.subscribe('auth.statusChange', updateButton);	
	};

	Array.prototype.pushUnique = function (item){
	    if(this.indexOf(item) == -1) {    
	        this.push(item);
	        return true;
	    }
	    return false;
	}
	
   
		
	function getHomeFeed(){
		button.innerHTML = 'Logout';

		var params = {limit:100};		
		FB.api('/me/home', 'get', params, function(response) {
		  if (!response || response.error) {
		    console.log('Error occured: ',response.error);
		  } else {
		  	var arr = [];
		  	console.log(response.data.length);
		  	var result = '<table border="1">';
		  	for (var i = response.data.length - 1; i >= 0; i--) {
		  		//arr.pushUnique(response.data[i].type);
		  		//TYPES: "link", "photo", "status", "swf", "video"

		  		/*
				<tr>
				<td>row 1, cell 1</td>
				<td>row 1, cell 2</td>
				</tr>
				<tr>
				<td>row 2, cell 1</td>
				<td>row 2, cell 2</td>
				</tr>
				</table>
				*/

		  		if(response.data[i].type == "video"){//|| response.data[i].type == "swf"
		  			var str = "";
		  			
		  			if(response.data[i].from){
		  				str+="from: <b>"+response.data[i].from.name+"</b><br>";
		  			}
		  			if(response.data[i].name){
		  				str+="<p>name: "+response.data[i].name+"</p><br>";
		  			}
		  			if(response.data[i].picture){
		  				str+= "<img src='"+response.data[i].picture+"'/><br>";
		  			}
		  			if(response.data[i].description){
		  				str+="<p>description: "+response.data[i].description+"</p><br>";	
		  			}
		  			
		  			if(response.data[i].type){
		  				str+="<p>type: "+response.data[i].type+"</p><br>";
		  			}
		  			if(response.data[i].source){
		  				str+="<p>Source: "+response.data[i].source+"</p><br>";	
		  			}
		  			if(response.data[i].link){
		  				str+="<a href='"+response.data[i].link+"'>Link</a><br><br>";
		  			} 			
		  			
		  			
		  			if(response.data[i].story_tags && response.data[i].story_tags[0]){
		  				console.log(response.data[i].story_tags[0][0].length);
		  				//str+="<p>Length: "+response.data[i].story_tags[0].length+"</p><br>";	
		  			}
		  			

		  			

		  			//str+='<iframe id="ytplayer" frameborder="0" allowfullscreen="1" title="YouTube video player" width="640" height="480" src="http://www.youtube.com/embed/_aJfWcSLYaE?rel=0&amp;showinfo=0&amp;modestbranding=1&amp;theme=dark&amp;autoplay=1&amp;enablejsapi=1&amp"></iframe>';
		  			

		  			$("#content").append(str);
		  			
		  			
		  		}

		  		
		  	};
		  	

		  	//console.log(arr);
		    
		  }
		});
	}
	    


	
</script>
<button id="fb-auth">Login</button>
<div id="content"></div>    

</body>
</html>